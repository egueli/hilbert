<!DOCTYPE html>
<html>
<head>
	<meta charset=utf-8>
	<title>My first Three.js app</title>
	<style>
		body { margin: 0; }
		canvas { width: 100%; height: 100% }
	</style>
</head>
<body>
	<script src="js/three.min.js"></script>
	<script src="js/hilbert.js"></script>
	<script>
		var scene = new THREE.Scene();
		var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );

		var renderer = new THREE.WebGLRenderer();
		renderer.setSize( window.innerWidth, window.innerHeight );
		document.body.appendChild( renderer.domElement );

		var light = new THREE.AmbientLight( 0x404040 ); // soft white light
		scene.add( light );

		var directionalLight = new THREE.DirectionalLight( 0xffffff, 1 );
		directionalLight.position.set( 1, 1, 1 );
		scene.add( directionalLight );

		var rootObject = new THREE.Object3D();
		scene.add(rootObject);

		camera.position.y = 1;
		camera.position.z = 1;
		camera.lookAt(new THREE.Vector3(0,0,0));

		buildGeometries();

		function render() {
			requestAnimationFrame( render );

			rootObject.rotation.y += 0.01;

			renderer.render( scene, camera );
		}
		render();

		function buildGeometries() {
			var green = new THREE.MeshLambertMaterial( { color: 0x00ff00 } );

			rootObject.add(new THREE.Mesh(new THREE.BoxGeometry(1.05,0.1,1.05), green));

			traverseRangeInHilbert(5, 0, 0.255, function(x, y, size) {
				var white = new THREE.MeshLambertMaterial( { color: 0xffffff } );
				var geometry = new THREE.BoxGeometry(size,0.25,size);
				var block = new THREE.Mesh(geometry, white);
				block.position.x = x - 0.5 + size / 2;
				block.position.z = y - 0.5 + size / 2;
				rootObject.add(block);
			});
		}


		function traverseRangeInHilbert(level, from, to, callback) {
			var size_t =  (1<<(2*level));
			var size_2d = (1<<level);
			var blockSize = 1 / size_2d;
			from = Math.max(0, from);
			to = Math.min(to, 1);
			var from_t = Math.round(from * size_t);
			var to_t = Math.round(to * size_t);
			for (var t = from_t; t < to_t; t++) {
				var xyH = hilbert.d2xy(level, t);
				var x = xyH[0] / size_2d;
				var y = xyH[1] / size_2d;
				callback(x, y, blockSize);
			}
		}
	</script>
</body>
</html>
